<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Booking Form HTML Template</title>

    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap -->
    <link type="text/css" rel="stylesheet" href="{% static 'bookingcss/bootstrap.min.css' %}" />

    <!-- Custom stylesheet -->
    <link type="text/css" rel="stylesheet" href="{% static 'bookingcss/style.css' %}" />

    <!-- jQuery UI CSS -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- Bootstrap Datepicker CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .nav1 {
            background: white;
            width: 100%;
            height: 75px;
            overflow: hidden;
            z-index: 1000;
            position: fixed;
            top: 0;
            left: 0px;
        }
        .error1 {
            color: green;
            font-size: 15px;
        }
        .datepicker-days .day.disabled1 {
            background-color: rgb(174, 137, 137) !important;
            color: white !important;
            cursor: not-allowed;
        }
        .k {
        border-radius: 100%;
    }
    .n9 {
        color: black;
        text-decoration: none;
        margin-top: -10px;
        margin-bottom: 10px;

        padding: 10 21;
        text-transform: uppercase;
        float: left;

    }

    .n9:hover {

        text-decoration: none;
        font-weight: bold;
        color: green;
    }

    .dropdown:hover .dropdown-content {
        display: block;
    }

   


    .desc {
        padding: 15px;
        text-align: center;

    }

    .dropdown {
        position: relative;
        display: inline-block;
        margin-top: 5px;
        margin-left: 40px;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #564646;
        min-width: 190px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        z-index: 1;
        margin-left: -140px;
        
    }
    .dropdown:hover .dropdown-content {
        display: block;
    }
    .service-item {
            background-color: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .service-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        .service-item img {
            width: 100%;
            height: auto;
            border-bottom: 1px solid #ddd;
        }
        .down-content {
            padding: 20px;
        }
        .down-content h4 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        .down-content h5 {
            font-size: 1em;
            color: #777;
            margin-bottom: 15px;
        }
        .down-content .price {
            font-size: 1.2em;
            color: #dc3545;
        }
        .filled-button {
            background-color: #007bff;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            text-transform: uppercase;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        .filled-button:hover {
            background-color: #0056b3;
        }
  

.container {
    max-width: 1200px;
    margin: auto;
    padding: 20px;
}


.col-md-4 {
    flex: 1 1 calc(33.333% - 20px); /* Three columns with space for gaps */
    box-sizing: border-box;
}

.service-item {
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid #ddd;
    text-align: left; /* Align text to the left */
}

.service-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
}

.service-item img {
    width: 100%;
    height: auto;
    object-fit: cover;
    display: block;
}

.down-content {
    padding: 15px;
}

.down-content h4 {
    font-size: 1.5em;
    margin-bottom: 10px;
    color: #007bff;
}

.down-content h5 {
    font-size: 1.1em;
    color: #555;
    margin-bottom: 10px;
}

.price {
    font-size: 1.2em;
    color: #28a745;
    margin-bottom: 15px;
}

.filled-button {
    background-color: #007bff;
    color: #fff;
    padding: 10px 20px;
    border-radius: 5px;
    text-transform: uppercase;
    text-decoration: none;
    display: inline-block;
    transition: background-color 0.3s ease;
}

.filled-button:hover {
    background-color: #0056b3;
}

.navbar-custom {
    background-color: #4CAF50; /* Change to your desired navbar color */
    position: fixed;
    width: 100%;
    top: 0;
    left: 0;
    z-index: 1000;
}

.navbar-custom .navbar-brand img {
    max-height: 52px;
}

.navbar-custom .navbar-nav .nav-link {
    color: white;
    font-weight: 600;
    font-size: 16px;
    padding: 15px 20px;
    transition: color 0.3s, background-color 0.3s;
}

.navbar-custom .navbar-nav .nav-link:hover,
.navbar-custom .navbar-nav .nav-link.active {
    color: #fff;
    background-color: #45a049; /* Darker green for hover */
    border-radius: 5px;
}

/* Dropdown Styles */

.dropdown img {
    border-radius: 50%;
}



.dropdown-content a {
    color: white;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    text-align: center;
    transition: background-color 0.3s;
}

.dropdown-content a:hover {
    background-color: #575757;
}

.dropdown:hover .dropdown-content {
    display: block;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .navbar-nav {
        text-align: center;
    }
    .navbar-nav .nav-link {
        padding: 10px 15px;
    }
    
}

.form-control {
    width: 100%; /* Ensures the select element takes up the full width of the parent */
}
.disabled-slot {
            color: gray;
            background-color: lightcoral;
        }
</style>
    </style>
</head>

<body>
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

    <!-- Bootstrap Datepicker JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

    <!-- Navbar -->
    
     

            <nav class="navbar navbar-expand-lg navbar-custom">
                <div style="margin-top: -30px;">
                <a class="navbar-brand" href="{% url 'userloginhome' %}">
                    <img src="{% static 'images/logonew.png' %}" alt="Company Logo">
                </a>
            </div>
                <div style="margin-left: 350px;">
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'userloginhome' %}">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'userloginhome' %}#about">About Us</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'userloginhome' %}#projects">Images</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="{% url 'servicelogin' %}">Services</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'userloginhome' %}#contact-us">Contact Us</a>
                        </li>
                        <li class="nav-item">
                            <div class="dropdown">
                                <img src="{% static user.photo %}" alt="User Photo" width="70" height="50" class="k">
                                <div class="dropdown-content">
                                    <a href="{% url 'useraccount' %}" target="__blank">Manage Account</a>
                                    <a href="bookingview.php">My Bookings</a>
                                    <a href="{% url 'logout' %}">Logout</a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            </nav>
        </div>
    </nav1>

    <!-- Booking Form -->
    <form action="{% url 'book' %}" method="POST">
        {% csrf_token %}
        <div id="booking" class="section">
            <div class="section-center"><br>
                <div class="container">
                    <div class="row">
                        <div class="col-md-7 col-md-push-5">
                            <div class="booking-cta">
                                <h1>BOOK YOUR SERVICE</h1>
                                <p>
                                    <font color="white">
                                        <h4>At Expert Homecare, we understand the importance of a well-maintained home and the peace of mind that comes with it. Whether you need a skilled plumber to fix a leaky faucet, an experienced electrician to handle your wiring issues, or any other home maintenance service, we are here to help. Our team of certified professionals is dedicated to providing top-notch services with utmost reliability and efficiency.</h4>
                                    </font>
                                </p>
                            </div>
                        </div>
                        <div class="col-md-4 col-md-pull-7">
                            <div class="booking-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <span class="form-label">Customer Name</span>
                                            <input class="form-control" type="text" placeholder="Service Provider Name" value="{{ user.first_name }} {{ user.last_name }}" name="sp_name" required readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <span class="form-label">Service Provider Name</span>
                                            <input class="form-control" type="text" placeholder="Service Provider Name" value="{{ data_to_display.service_provider_name }}" name="sp_name" required readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <span class="form-label">Service Location Address</span>
                                            <input class="form-control" type="text" placeholder="Service Location Address" id="address" name="address" value="{{ user.address }}"required>
                                            <input class="form-control" type="hidden" placeholder="Customer id" value="{{ user.id }}" name="customer_id">
                                            <input class="form-control" type="hidden" placeholder="Service Provider id" value="{{ data_to_display.service_provider_id }}" name="service_provider_id">
                                        </div>
                                    </div>
                                   

                            
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <span class="form-label">Preferred Dates</span>
                                            <input class="form-control datepicker" type="text" placeholder="Select dates" id="booking_dates" name="dates" required readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <span class="form-label">Time Slot Option</span>
                                            <select class="form-control" id="time_option" name="time_option">
                                                <option value="" selected disabled hidden>Select Time Slot</option>
                                               
                                                <option value="AM">AM</option>
                                                <option value="PM">PM</option>
                                                <option value="FULL_DAY">Full Day</option>
                    
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <span id="selected_dates_list1" class="form-label"></span>
                                            <ul id="selected_dates_list" class="list-group"></ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <span class="form-label">Description of the Issue or Service Needed</span>
                                    <textarea class="form-control" id="detail" name="detail" placeholder="Description of the Issue or Service Needed..." style="width: 100%; height: 100px;" required></textarea>
                                </div>
                                <br>
                                <div style="margin-top:-20px;"><span id="availability"></span></div><br>
                                <div class="row">
                                    <div class="col-sm-6"></div>
                                </div>
                               
                                <div class="form-btn">
                                    <input type="submit" value="Book" id="register" class="submit-btn">
                                    <div style="margin-left:230px;margin-top:-40px">
                                        <a href="\mathew\miniproject-s6/caravan1.php" class="submit-btn" style="text-decoration:none">Cancel</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
    </form>

<script>

$(document).ready(function() {
    var bookedDates = {{ booked_dates|safe }};
    var selectedDates = {}; // Object to store selected dates and their booked slots
    var mod1 = 1; // Initialize mod1

    // Function to update button state
    function updateButtonState() {
        if (mod1 === 1) {
            $('#register').attr("disabled", true).css("background", "lightblue");
        } else {
            $('#register').attr("disabled", false).css("background", "#4272d7");
        }
    }

    $("#booking_dates").blur(function () {
        var n = $(this).val();
        
        if (n === "") { // Corrected condition to check for empty string
            mod1 = 1;
        } else {
            mod1 = 0; // Update mod1 to 0 if input is not empty
        }
        
        updateButtonState(); // Update button state based on mod1
    });

    // Initialize datepicker
    $('.datepicker').datepicker({
        format: 'dd-mm-yyyy',
        startDate: '0d',
        multidate: true,  // Allow multiple date selections
        todayHighlight: true,
        beforeShowDay: function(date) {
            var dateStr = date.toISOString().split('T')[0];
            if (bookedDates[dateStr] && bookedDates[dateStr].includes('FULL_DAY')) {
                return {
                    enabled: false,
                    classes: 'disabled1'
                };
            }
            return;
        }
    }).on('changeDate', function(e) {
        var dates = e.dates.map(d => d.toISOString().split('T')[0]);
        console.log('Selected Dates:', dates); // Debugging statement

        // Update selectedDates to reflect the current selection
       
        dates.forEach(function(date) {
            if (!selectedDates[date]) {
                selectedDates[date] = []; // Initialize with an empty array
            }
        });

        // Enable the button when dates are selected
        mod1 = dates.length > 0 ? 0 : 1;
        updateButtonState(); // Update button state based on mod1

        // Update the display of selected dates and their time slots
        updateSelectedDatesDisplay();
    });

    $('#time_option').change(function() {
        var selectedTime = $(this).val();
        var selectedDatesArray = $('.datepicker').datepicker('getDates').map(date => date.toISOString().split('T')[0]);
        var selectedDate = selectedDatesArray[selectedDatesArray.length - 1]; // Use the most recently selected date
       
        if (selectedDate) {
            var dateStr = selectedDate;

            // Initialize the date entry if it doesn't exist
            if (!selectedDates[dateStr]) {
                selectedDates[dateStr] = []; // Initialize with an empty array
            }

            if (selectedTime) {
                console.log('Selected Time:', selectedTime);
                console.log('Date String:', dateStr);
                console.log('Current Slots:', selectedDates[dateStr]);

                // Update the selected time slots
                if (!selectedDates[dateStr].includes(selectedTime)) {
                    // Add the selected time slot
                    selectedDates[dateStr].push(selectedTime);
                } else {
                    // Remove the selected time slot if it's already present
                    selectedDates[dateStr] = selectedDates[dateStr].filter(slot => slot !== selectedTime);
                }

                // Manage conflicts based on the selected time slot
                if (selectedTime === 'AM') {
                    selectedDates[dateStr] = selectedDates[dateStr].filter(slot => slot !== 'PM' && slot !== 'FULL_DAY');
                } else if (selectedTime === 'PM') {
                    selectedDates[dateStr] = selectedDates[dateStr].filter(slot => slot !== 'AM' && slot !== 'FULL_DAY');
                } else if (selectedTime === 'FULL_DAY') {
                    selectedDates[dateStr] = selectedDates[dateStr].filter(slot => slot !== 'AM' && slot !== 'PM');
                }

                // Ensure no conflicts if multiple time slots are selected
                if (selectedDates[dateStr].includes('AM') || selectedDates[dateStr].includes('PM')) {
                    selectedDates[dateStr] = selectedDates[dateStr].filter(slot => slot !== 'FULL_DAY');
                }

                console.log('Updated Slots:', selectedDates[dateStr]);
                
                // Update the time options for the most recently selected date
                updateTimeOptions(dateStr);
                
                // Update the display of selected dates and their time slots
                updateSelectedDatesDisplay();
            }
        }
    });

    // Function to update the display of selected dates and their time slots
    function updateSelectedDatesDisplay() {
    var list = $('#selected_dates_list');
    var list1 = $('#selected_dates_list1');
  
    list.empty();
    list1.empty();
    list1.text("Selected Dates and Slots");

    // Function to format date as dd-mm-yyyy
    function formatDate(dateStr) {
        var parts = dateStr.split('-');
        return parts[2] + '-' + parts[1] + '-' + parts[0]; // Convert to dd-mm-yyyy
    }

    $.each(selectedDates, function(date, slots) {
        // Format the date
        var formattedDate = formatDate(date);
        // Create a list item with formatted date
        var listItem = $('<li class="list-group-item"></li>').text(formattedDate + ' - ' + slots.join(', '));
        list.append(listItem);
    });
}


    // Function to update time options based on the selected date
    function updateTimeOptions(date) {
        var bookedSlots = bookedDates[date] || [];
        $('#time_option option').each(function() {
            var slot = $(this).val();
            var isDisabled = bookedSlots.includes(slot) || bookedSlots.includes('FULL_DAY');
            
            // Disable "FULL_DAY" option if either "AM" or "PM" is booked
            if (slot === 'FULL_DAY') {
                isDisabled = bookedSlots.includes('AM') || bookedSlots.includes('PM');
            }

            if (isDisabled) {
                $(this).attr('disabled', true).addClass('disabled-slot');
            } else {
                $(this).attr('disabled', false).removeClass('disabled-slot');
            }
        });
    }

    // Initially set the button state based on mod1
    updateButtonState();
});


    </script>
</body>
</html>
